messageLibrary = {
    "Energy": [158, 11], "EnergyFromSystem": [25, 1],
    "HasRGM": [14, 40], "Power": [51, 4],
    "ACVoltage": [51, 1], "ACFrequency": [51, 2],
    "ACCurrent": [51, 3], "PV1Voltage": [28, 1],
    "PV1Current": [28, 2], "PV2Voltage": [36, 1],
    "PV2Current": [36, 2], "PV3Voltage": [44, 1],
    "PV3Current": [44, 2], "PV4Voltage": [48, 1],
    "PV4Current": [48, 2], "RequestNumber": [120, 228],
    "RequestIndex": [120, 229], "RequestOffset": [120, 230],
    "RequestData": [120, 103], "RequestMonthlyEnergy": [120, 104],
    "SyncDate": [0, 160], "SyncTime": [0, 161],
    "GetAccess": [100, 253], "Mode1": [149, 130],
    "Mode2": [150, 130], "Mode3": [151, 130],
    "Mode4": [164, 2], "StandBy1": [149, 1],
    "StandBy2": [150, 1], "StandBy3": [151, 1],
    "StandBy4": [164, 1], "SetScanFactor": [121, 148],
    "PV1Length": [121, 21], "PV2Length": [121, 22],
    "PV3Length": [121, 23], "PV4Length": [121, 42],
    "GetScanData1": [121, 17], "GetScanData2": [121, 18],
    "GetScanData3": [121, 19], "GetScanData4": [121, 41],
    "ReadLog": [121, 12], "WriteHistoryDate": [18, 158],
    "WriteHistoryCategory": [18, 159], "WriteHistoryIndex": [18, 163],
    "HistoryStandBy": [18, 32], "HistoryNumber": [18, 33],
    "ReadHistory": [18, 34], "SystemVersion": [120, 5],
    "PowerVersion": [121, 5], "SafetyVersion": [123, 5],
    "Pv1MaxPower": [155, 1], "Pv1MaxVoltage": [155, 2],
    "Pv1MaxCurrent": [155, 3], "Pv2MaxPower": [156, 1],
    "Pv2MaxVoltage": [156, 2], "Pv2MaxCurrent": [156, 3],
    "Pv3MaxPower": [157, 1], "Pv3MaxVoltage": [157, 2],
    "Pv3MaxCurrent": [157, 3], "Pv4MaxPower": [166, 1],
    "Pv4MaxVoltage": [166, 2], "Pv4MaxCurrent": [166, 3],
    "AcMaxVoltage": [158, 2], "AcMaxFrequency": [158, 4],
    "AcMaxCurrent": [158, 5], "AcMaxActivePower": [158, 6],
    "AcMaxReactivePower": [158, 8], "EnableArc": [119, 129],
    "ReadArc": [119, 2], "PCSRunning": [110, 44],
    "CheckOffGrid": [115, 4], "ArcReset": [119, 14],
    "ArcEnable": [119, 11], "ArcSelfTest": [119, 15],
    "ArcType": [119, 18], "Arc1024": [119, 60],
    "ArcNormal": [119, 66], "RcdReset": [115, 148],
    "CurrentPowerError": [121, 2], "CurrentSafetyError": [121, 3],
    "PinMessage": [1, 1], "SerialNumber": [0, 9],
    "SynchronizationDone": [123, 1], "SynchronizationProgress": [115, 46],
    "SynchronizationLength": [115, 53], "DailyEnergy": [21, 45],
    "ZigBeeMacAddressHigh": [0, 102], "ZigBeeMacAddressLow": [0, 103],
    "ZigBeePANID": [0, 105], "ZigBeeStatus": [0, 101],
    "ZigBeeRssi": [0, 104], "ResetSystemData": [20, 6],
    "ResetLowerData": [110, 42], "CheckData1": [21, 1],
    "CheckData2": [25, 1], "CheckData3": [158, 11],
    "Timezone": [0, 34], "SaveSystem": [120, 9],
    "SaveTOUConfig": [120, 9], "WritePANID": [0, 106],
    "ReadPANIDList": [0, 107], "GridVoltage": [80, 10],
    "SystemLog": [14, 4], "PVCount": [100, 26],
    "PV1Available": [149, 3], "PV2Available": [150, 3],
    "PV3Available": [151, 3], "PV4Available": [164, 3],
    "PV1DoubleCheck": [26, 1], "PV2DoubleCheck": [34, 1],
    "PV3DoubleCheck": [42, 1], "PV4DoubleCheck": [46, 1],
    "InverterMode": [110, 5], "SyncDetail": [123, 1],
    "FirstLaunch": [8, 1], "CheckBIN": [19, 8],
    "ECBId": [20, 1], "ECBEnable": [20, 100],
    "InverterModel": [110, 3], "InverterModelName": [110, 7],
    "GatewayBundle": [1, 10], "SaveAll": [1, 0],
    "WriteSerialNumber": [110, 134], "MachineCode": [110, 45],
    "AUCountryCode": [20, 7], "UtilityCode": [20, 14],
    "SafetyEnable": [5, 1], "InverterPower": [1, 91],
    "MicroInverterPower": [1, 95], "GridPower": [1, 96],
    "LoadPower": [1, 94], "BatteryPower": [1, 92],
    "EMSError": [1, 51], "ReadDate": [0, 32],
    "ReadTime": [0, 33], "MicroCurrent": [14, 90],
    "MicroVoltage": [14, 94], "MicroFrequency": [14, 95],
    "GatewayReset": [1, 10], "CurrentError": [2, 80],
    "StandbyState": [1, 47]
}

messageHexLib = {
    "Energy": "020501029e0b459b03",
    "EnergyFromSystem": "020501021901a66c03",
    "HasRGM": "020501020e28684203",
    "Power": "020501023304790f03",
    "ACVoltage": "020501023301b90c03",
    "ACFrequency": "020501023302f90d03",
    "ACCurrent": "02050102330338cd03",
    "PV1Voltage": "020501021c01a53c03",
    "PV1Current": "020501021c02e53d03",
    "PV2Voltage": "020501022401b6fc03",
    "PV2Current": "020501022402f6fd03",
    "PV3Voltage": "020501022c01b13c03",
    "PV3Current": "020501022c02f13d03",
    "PV4Voltage": "020501023001b9fc03",
    "PV4Current": "020501023002f9fd03",
    "RequestNumber": "0205010278e44e7703",
    "RequestIndex": "0205010278e58fb703",
    "RequestOffset": "0205010278e6cfb603",
    "RequestData": "0205010278670fd603",
    "RequestMonthlyEnergy": "0205010278684fd203",
    "SyncDate": "0205010200a06c4403",
    "SyncTime": "0205010200a1ad8403",
    "GetAccess": "0205010264fd877d03",
    "Mode1": "020501029582830d03",
    "Mode2": "02050102968283fd03",
    "Mode3": "020501029782826d03",
    "Mode4": "02050102a402973d03",
    "StandBy1": "020501029501c2ac03",
    "StandBy2": "020501029601c25c03",
    "StandBy3": "020501029701c3cc03",
    "StandBy4": "02050102a401d73c03",
    "SetScanFactor": "0205010279944e0303",
    "PV1Length": "0205010279158e6303",
    "PV2Length": "020501027916ce6203",
    "PV3Length": "0205010279170fa203",
    "PV4Length": "02050102792ace7303",
    "GetScanData1": "0205010279118fa003",
    "GetScanData2": "020501027912cfa103",
    "GetScanData3": "0205010279130e6103",
    "GetScanData4": "0205010279298e7203",
    "ReadLog": "02050102790c4fa903",
    "WriteHistoryDate": "02050102129ee13403",
    "WriteHistoryCategory": "02050102129f20f403",
    "WriteHistoryIndex": "0205010212a320e503",
    "HistoryStandBy": "020501021220614403",
    "HistoryNumber": "020501021221a08403",
    "ReadHistory": "020501021222e08503",
    "SystemVersion": "0205010278058e3f03",
    "PowerVersion": "0205010279058faf03",
    "SafetyVersion": "020501027b058ecf03",
    "Pv1MaxPower": "020501029b01c6cc03",
    "Pv1MaxVoltage": "020501029b0286cd03",
    "Pv1MaxCurrent": "020501029b03470d03",
    "Pv2MaxPower": "020501029c01c4fc03",
    "Pv2MaxVoltage": "020501029c0284fd03",
    "Pv2MaxCurrent": "020501029c03453d03",
    "Pv3MaxPower": "020501029d01c56c03",
    "Pv3MaxVoltage": "020501029d02856d03",
    "Pv3MaxCurrent": "020501029d0344ad03",
    "Pv4MaxPower": "02050102a601d65c03",
    "Pv4MaxVoltage": "02050102a602965d03",
    "Pv4MaxCurrent": "02050102a603579d03",
    "AcMaxVoltage": "020501029e02859d03",
    "AcMaxFrequency": "020501029e04059f03",
    "AcMaxCurrent": "020501029e05c45f03",
    "AcMaxActivePower": "020501029e06845e03",
    "AcMaxReactivePower": "020501029e08059a03",
    "EnableArc": "0205010277818bac03",
    "ReadArc": "020501027702ca0d03",
    "PCSRunning": "020501026e2c418103",
    "CheckOffGrid": "02050102730448cf03",
    "ArcReset": "02050102770eca0803",
    "ArcEnable": "02050102770b0a0b03",
    "ArcSelfTest": "02050102770f0bc803",
    "ArcType": "020501027712cbc103",
    "Arc1024": "02050102773c4bdd03",
    "ArcNormal": "020501027742cbfd03",
    "RcdReset": "02050102739448a303",
    "CurrentPowerError": "020501027902ce6d03",
    "CurrentSafetyError": "0205010279030fad03",
    "PinMessage": "020501020101ac6c03",
    "SerialNumber": "020501020009ac3a03",
    "SynchronizationDone": "020501027b018f0c03",
    "SynchronizationProgress": "02050102732ec91003",
    "SynchronizationLength": "020501027335891b03",
    "DailyEnergy": "02050102152da2b103",
    "ZigBeeMacAddressHigh": "020501020066ec1603",
    "ZigBeeMacAddressLow": "0205010200672dd603",
    "ZigBeePANID": "020501020069ac1203",
    "ZigBeeStatus": "020501020065ac1703",
    "ZigBeeRssi": "0205010200686dd203",
    "ResetSystemData": "020501021406e33e03",
    "ResetLowerData": "020501026e2ac18303",
    "CheckData1": "020501021501a36c03",
    "CheckData2": "020501021901a66c03",
    "CheckData3": "020501029e0b459b03",
    "Timezone": "020501020022ec2503",
    "SaveSystem": "0205010278098e3a03",
    "SaveTOUConfig": "0205010278098e3a03",
    "WritePANID": "02050102006aec1303",
    "ReadPANIDList": "02050102006b2dd303",
    "GridVoltage": "02050102500ad03b03",
    "SystemLog": "020501020e04699f03",
    "PVCount": "02050102641ac73703",
    "PV1Available": "020501029503436d03",
    "PV2Available": "020501029603439d03",
    "PV3Available": "020501029703420d03",
    "PV4Available": "02050102a40356fd03",
    "PV1DoubleCheck": "020501021a01a69c03",
    "PV2DoubleCheck": "020501022201b55c03",
    "PV3DoubleCheck": "020501022a01b29c03",
    "PV4DoubleCheck": "020501022e01b05c03",
    "InverterMode": "020501026e05805f03",
    "SyncDetail": "020501027b018f0c03",
    "FirstLaunch": "020501020801aa3c03",
    "CheckBIN": "02050102130860ca03",
    "ECBId": "020501021401a2fc03",
    "ECBEnable": "02050102146462d703",
    "InverterModel": "020501026e03005d03",
    "InverterModelName": "020501026e07019e03",
    "GatewayBundle": "02050102010aedab03",
    "SaveAll": "0205010201006dac03",
    "WriteSerialNumber": "020501026e86c1fe03",
    "MachineCode": "020501026e2d804103",
    "AUCountryCode": "02050102140722fe03",
    "UtilityCode": "02050102140ee2f803",
    "SafetyEnable": "020501020501aeac03",
    "InverterPower": "02050102015b2c5703",
    "MicroInverterPower": "02050102015f2d9403",
    "GridPower": "0205010201606d8403",
    "LoadPower": "02050102015eec5403",
    "BatteryPower": "02050102015c6d9503",
    "EMSError": "0205010201332db903",
    "ReadDate": "0205010200206de403",
    "ReadTime": "020501020021ac2403",
    "MicroCurrent": "020501020e5ae86703",
    "MicroVoltage": "020501020e5ee9a403",
    "MicroFrequency": "020501020e5f286403",
    "GatewayReset": "02050102010aedab03",
    "CurrentError": "0205010202506d6003",
    "StandbyState": "02050102012f2c7003"
}
message_string_by_hex = {v: k for k, v in messageHexLib.items()}

"""
Hex values of each message:
Energy                   : 02 05 01 02 9e 0b 45 9b 03   : 020501029e0b459b03
EnergyFromSystem         : 02 05 01 02 19 01 a6 6c 03   : 020501021901a66c03
HasRGM                   : 02 05 01 02 0e 28 68 42 03   : 020501020e28684203
Power                    : 02 05 01 02 33 04 79 0f 03   : 020501023304790f03
ACVoltage                : 02 05 01 02 33 01 b9 0c 03   : 020501023301b90c03
ACFrequency              : 02 05 01 02 33 02 f9 0d 03   : 020501023302f90d03
ACCurrent                : 02 05 01 02 33 03 38 cd 03   : 02050102330338cd03
PV1Voltage               : 02 05 01 02 1c 01 a5 3c 03   : 020501021c01a53c03
PV1Current               : 02 05 01 02 1c 02 e5 3d 03   : 020501021c02e53d03
PV2Voltage               : 02 05 01 02 24 01 b6 fc 03   : 020501022401b6fc03
PV2Current               : 02 05 01 02 24 02 f6 fd 03   : 020501022402f6fd03
PV3Voltage               : 02 05 01 02 2c 01 b1 3c 03   : 020501022c01b13c03
PV3Current               : 02 05 01 02 2c 02 f1 3d 03   : 020501022c02f13d03
PV4Voltage               : 02 05 01 02 30 01 b9 fc 03   : 020501023001b9fc03
PV4Current               : 02 05 01 02 30 02 f9 fd 03   : 020501023002f9fd03
RequestNumber            : 02 05 01 02 78 e4 4e 77 03   : 0205010278e44e7703
RequestIndex             : 02 05 01 02 78 e5 8f b7 03   : 0205010278e58fb703
RequestOffset            : 02 05 01 02 78 e6 cf b6 03   : 0205010278e6cfb603
RequestData              : 02 05 01 02 78 67 0f d6 03   : 0205010278670fd603
RequestMonthlyEnergy     : 02 05 01 02 78 68 4f d2 03   : 0205010278684fd203
SyncDate                 : 02 05 01 02 00 a0 6c 44 03   : 0205010200a06c4403
SyncTime                 : 02 05 01 02 00 a1 ad 84 03   : 0205010200a1ad8403
GetAccess                : 02 05 01 02 64 fd 87 7d 03   : 0205010264fd877d03
Mode1                    : 02 05 01 02 95 82 83 0d 03   : 020501029582830d03
Mode2                    : 02 05 01 02 96 82 83 fd 03   : 02050102968283fd03
Mode3                    : 02 05 01 02 97 82 82 6d 03   : 020501029782826d03
Mode4                    : 02 05 01 02 a4 02 97 3d 03   : 02050102a402973d03
StandBy1                 : 02 05 01 02 95 01 c2 ac 03   : 020501029501c2ac03
StandBy2                 : 02 05 01 02 96 01 c2 5c 03   : 020501029601c25c03
StandBy3                 : 02 05 01 02 97 01 c3 cc 03   : 020501029701c3cc03
StandBy4                 : 02 05 01 02 a4 01 d7 3c 03   : 02050102a401d73c03
SetScanFactor            : 02 05 01 02 79 94 4e 03 03   : 0205010279944e0303
PV1Length                : 02 05 01 02 79 15 8e 63 03   : 0205010279158e6303
PV2Length                : 02 05 01 02 79 16 ce 62 03   : 020501027916ce6203
PV3Length                : 02 05 01 02 79 17 0f a2 03   : 0205010279170fa203
PV4Length                : 02 05 01 02 79 2a ce 73 03   : 02050102792ace7303
GetScanData1             : 02 05 01 02 79 11 8f a0 03   : 0205010279118fa003
GetScanData2             : 02 05 01 02 79 12 cf a1 03   : 020501027912cfa103
GetScanData3             : 02 05 01 02 79 13 0e 61 03   : 0205010279130e6103
GetScanData4             : 02 05 01 02 79 29 8e 72 03   : 0205010279298e7203
ReadLog                  : 02 05 01 02 79 0c 4f a9 03   : 02050102790c4fa903
WriteHistoryDate         : 02 05 01 02 12 9e e1 34 03   : 02050102129ee13403
WriteHistoryCategory     : 02 05 01 02 12 9f 20 f4 03   : 02050102129f20f403
WriteHistoryIndex        : 02 05 01 02 12 a3 20 e5 03   : 0205010212a320e503
HistoryStandBy           : 02 05 01 02 12 20 61 44 03   : 020501021220614403
HistoryNumber            : 02 05 01 02 12 21 a0 84 03   : 020501021221a08403
ReadHistory              : 02 05 01 02 12 22 e0 85 03   : 020501021222e08503
SystemVersion            : 02 05 01 02 78 05 8e 3f 03   : 0205010278058e3f03
PowerVersion             : 02 05 01 02 79 05 8f af 03   : 0205010279058faf03
SafetyVersion            : 02 05 01 02 7b 05 8e cf 03   : 020501027b058ecf03
Pv1MaxPower              : 02 05 01 02 9b 01 c6 cc 03   : 020501029b01c6cc03
Pv1MaxVoltage            : 02 05 01 02 9b 02 86 cd 03   : 020501029b0286cd03
Pv1MaxCurrent            : 02 05 01 02 9b 03 47 0d 03   : 020501029b03470d03
Pv2MaxPower              : 02 05 01 02 9c 01 c4 fc 03   : 020501029c01c4fc03
Pv2MaxVoltage            : 02 05 01 02 9c 02 84 fd 03   : 020501029c0284fd03
Pv2MaxCurrent            : 02 05 01 02 9c 03 45 3d 03   : 020501029c03453d03
Pv3MaxPower              : 02 05 01 02 9d 01 c5 6c 03   : 020501029d01c56c03
Pv3MaxVoltage            : 02 05 01 02 9d 02 85 6d 03   : 020501029d02856d03
Pv3MaxCurrent            : 02 05 01 02 9d 03 44 ad 03   : 020501029d0344ad03
Pv4MaxPower              : 02 05 01 02 a6 01 d6 5c 03   : 02050102a601d65c03
Pv4MaxVoltage            : 02 05 01 02 a6 02 96 5d 03   : 02050102a602965d03
Pv4MaxCurrent            : 02 05 01 02 a6 03 57 9d 03   : 02050102a603579d03
AcMaxVoltage             : 02 05 01 02 9e 02 85 9d 03   : 020501029e02859d03
AcMaxFrequency           : 02 05 01 02 9e 04 05 9f 03   : 020501029e04059f03
AcMaxCurrent             : 02 05 01 02 9e 05 c4 5f 03   : 020501029e05c45f03
AcMaxActivePower         : 02 05 01 02 9e 06 84 5e 03   : 020501029e06845e03
AcMaxReactivePower       : 02 05 01 02 9e 08 05 9a 03   : 020501029e08059a03
EnableArc                : 02 05 01 02 77 81 8b ac 03   : 0205010277818bac03
ReadArc                  : 02 05 01 02 77 02 ca 0d 03   : 020501027702ca0d03
PCSRunning               : 02 05 01 02 6e 2c 41 81 03   : 020501026e2c418103
CheckOffGrid             : 02 05 01 02 73 04 48 cf 03   : 02050102730448cf03
ArcReset                 : 02 05 01 02 77 0e ca 08 03   : 02050102770eca0803
ArcEnable                : 02 05 01 02 77 0b 0a 0b 03   : 02050102770b0a0b03
ArcSelfTest              : 02 05 01 02 77 0f 0b c8 03   : 02050102770f0bc803
ArcType                  : 02 05 01 02 77 12 cb c1 03   : 020501027712cbc103
Arc1024                  : 02 05 01 02 77 3c 4b dd 03   : 02050102773c4bdd03
ArcNormal                : 02 05 01 02 77 42 cb fd 03   : 020501027742cbfd03
RcdReset                 : 02 05 01 02 73 94 48 a3 03   : 02050102739448a303
CurrentPowerError        : 02 05 01 02 79 02 ce 6d 03   : 020501027902ce6d03
CurrentSafetyError       : 02 05 01 02 79 03 0f ad 03   : 0205010279030fad03
PinMessage               : 02 05 01 02 01 01 ac 6c 03   : 020501020101ac6c03
SerialNumber             : 02 05 01 02 00 09 ac 3a 03   : 020501020009ac3a03
SynchronizationDone      : 02 05 01 02 7b 01 8f 0c 03   : 020501027b018f0c03
SynchronizationProgress  : 02 05 01 02 73 2e c9 10 03   : 02050102732ec91003
SynchronizationLength    : 02 05 01 02 73 35 89 1b 03   : 020501027335891b03
DailyEnergy              : 02 05 01 02 15 2d a2 b1 03   : 02050102152da2b103
ZigBeeMacAddressHigh     : 02 05 01 02 00 66 ec 16 03   : 020501020066ec1603
ZigBeeMacAddressLow      : 02 05 01 02 00 67 2d d6 03   : 0205010200672dd603
ZigBeePANID              : 02 05 01 02 00 69 ac 12 03   : 020501020069ac1203
ZigBeeStatus             : 02 05 01 02 00 65 ac 17 03   : 020501020065ac1703
ZigBeeRssi               : 02 05 01 02 00 68 6d d2 03   : 0205010200686dd203
ResetSystemData          : 02 05 01 02 14 06 e3 3e 03   : 020501021406e33e03
ResetLowerData           : 02 05 01 02 6e 2a c1 83 03   : 020501026e2ac18303
CheckData1               : 02 05 01 02 15 01 a3 6c 03   : 020501021501a36c03
CheckData2               : 02 05 01 02 19 01 a6 6c 03   : 020501021901a66c03
CheckData3               : 02 05 01 02 9e 0b 45 9b 03   : 020501029e0b459b03
Timezone                 : 02 05 01 02 00 22 ec 25 03   : 020501020022ec2503
SaveSystem               : 02 05 01 02 78 09 8e 3a 03   : 0205010278098e3a03
SaveTOUConfig            : 02 05 01 02 78 09 8e 3a 03   : 0205010278098e3a03
WritePANID               : 02 05 01 02 00 6a ec 13 03   : 02050102006aec1303
ReadPANIDList            : 02 05 01 02 00 6b 2d d3 03   : 02050102006b2dd303
GridVoltage              : 02 05 01 02 50 0a d0 3b 03   : 02050102500ad03b03
SystemLog                : 02 05 01 02 0e 04 69 9f 03   : 020501020e04699f03
PVCount                  : 02 05 01 02 64 1a c7 37 03   : 02050102641ac73703
PV1Available             : 02 05 01 02 95 03 43 6d 03   : 020501029503436d03
PV2Available             : 02 05 01 02 96 03 43 9d 03   : 020501029603439d03
PV3Available             : 02 05 01 02 97 03 42 0d 03   : 020501029703420d03
PV4Available             : 02 05 01 02 a4 03 56 fd 03   : 02050102a40356fd03
PV1DoubleCheck           : 02 05 01 02 1a 01 a6 9c 03   : 020501021a01a69c03
PV2DoubleCheck           : 02 05 01 02 22 01 b5 5c 03   : 020501022201b55c03
PV3DoubleCheck           : 02 05 01 02 2a 01 b2 9c 03   : 020501022a01b29c03
PV4DoubleCheck           : 02 05 01 02 2e 01 b0 5c 03   : 020501022e01b05c03
InverterMode             : 02 05 01 02 6e 05 80 5f 03   : 020501026e05805f03
SyncDetail               : 02 05 01 02 7b 01 8f 0c 03   : 020501027b018f0c03
FirstLaunch              : 02 05 01 02 08 01 aa 3c 03   : 020501020801aa3c03
CheckBIN                 : 02 05 01 02 13 08 60 ca 03   : 02050102130860ca03
ECBId                    : 02 05 01 02 14 01 a2 fc 03   : 020501021401a2fc03
ECBEnable                : 02 05 01 02 14 64 62 d7 03   : 02050102146462d703
InverterModel            : 02 05 01 02 6e 03 00 5d 03   : 020501026e03005d03
InverterModelName        : 02 05 01 02 6e 07 01 9e 03   : 020501026e07019e03
GatewayBundle            : 02 05 01 02 01 0a ed ab 03   : 02050102010aedab03
SaveAll                  : 02 05 01 02 01 00 6d ac 03   : 0205010201006dac03
WriteSerialNumber        : 02 05 01 02 6e 86 c1 fe 03   : 020501026e86c1fe03
MachineCode              : 02 05 01 02 6e 2d 80 41 03   : 020501026e2d804103
AUCountryCode            : 02 05 01 02 14 07 22 fe 03   : 02050102140722fe03
UtilityCode              : 02 05 01 02 14 0e e2 f8 03   : 02050102140ee2f803
SafetyEnable             : 02 05 01 02 05 01 ae ac 03   : 020501020501aeac03
InverterPower            : 02 05 01 02 01 5b 2c 57 03   : 02050102015b2c5703
MicroInverterPower       : 02 05 01 02 01 5f 2d 94 03   : 02050102015f2d9403
GridPower                : 02 05 01 02 01 60 6d 84 03   : 0205010201606d8403
LoadPower                : 02 05 01 02 01 5e ec 54 03   : 02050102015eec5403
BatteryPower             : 02 05 01 02 01 5c 6d 95 03   : 02050102015c6d9503
EMSError                 : 02 05 01 02 01 33 2d b9 03   : 0205010201332db903
ReadDate                 : 02 05 01 02 00 20 6d e4 03   : 0205010200206de403
ReadTime                 : 02 05 01 02 00 21 ac 24 03   : 020501020021ac2403
MicroCurrent             : 02 05 01 02 0e 5a e8 67 03   : 020501020e5ae86703
MicroVoltage             : 02 05 01 02 0e 5e e9 a4 03   : 020501020e5ee9a403
MicroFrequency           : 02 05 01 02 0e 5f 28 64 03   : 020501020e5f286403
GatewayReset             : 02 05 01 02 01 0a ed ab 03   : 02050102010aedab03
CurrentError             : 02 05 01 02 02 50 6d 60 03   : 0205010202506d6003
StandbyState             : 02 05 01 02 01 2f 2c 70 03   : 02050102012f2c7003
"""

# these are the hex values written to handle 0x22
# as extracted from an hcidump and analyzed in wireshark
# when loading the top-level "monitor" screen
sent_values = [
    "020501020009ac3a03", "0165b4340001ea3c",
    "0205010278058e3f03", "0205010464fd1984202203",
    "0205010600a002080215585003", "0205010500a10b020543f703",
    "020501020022ec2503", "0205010279058faf03",
    "020501027b058ecf03", "020501020e28684203",
    "020501027902ce6d03", "0205010279030fad03",
    "020501027b018f0c03", "02050102732ec91003",
    "020501027335891b03", "020501021901a66c03",
    "02050102152da2b103", "020501023304790f03",
    "020501021c01a53c03", "020501021c02e53d03",
    "020501022401b6fc03", "020501022402f6fd03",
    "020501022c01b13c03", "020501022c02f13d03",
    "020501023001b9fc03", "020501023002f9fd03",
    "020501023301b90c03", "02050102330338cd03",
    "020501023302f90d03", "0205010279058faf03",
    "020501027b058ecf03", "020501020e28684203",
    "020501027902ce6d03", "0205010279030fad03",
    "020501027b018f0c03", "02050102732ec91003",
    "020501027335891b03", "020501021901a66c03",
    "02050102152da2b103", "020501023304790f03",
    "020501021c01a53c03", "020501021c02e53d03",
    "020501022401b6fc03", "020501022402f6fd03",
    "020501022c01b13c03", "020501022c02f13d03",
    "020501023001b9fc03", "020501023002f9fd03",
    "020501023301b90c03", "02050102330338cd03",
    "020501023302f90d03"
]

# These are the hex values received as notifications
# by the phone during an hcidump of loading the
# top-level "monitor" screen in the M professional app
# (should match ``sent_values`` above)
received_values = [
    "02060114000920202020204f4147323031353030",
    "30343238ed0f03", "0165b43400010200009134",
    "02060105780502020d511c03", "0206010464fd1984132203",
    "0206010600a0020802154ca003", "0206010500a10b020503e203",
    "02060103002211e54e03", "0206010579050104071f7b03",
    "020601057b05010403677803", "020601030e2800422103",
    "02060106790200000000fe0503", "02060106790300000000c3c503",
    "020601067b01000003fffb5703", "02060106732e000000006f6903",
    "0206010473357530ba1f03", "0206010a190100000000000187cdfa5203",
    "02060106152d000004cea1fb03", "02060104330407279abe03",
    "020601041c010125000a03", "020601041c020026b19b03",
    "02060104240100d64cbf03", "0206010424020021fd3903",
    "020601042c010004ce8203", "020601042c0200003f4103",
    "021501023001783f03", "021501023002383e03",
    "020601043301010108c503", "0206010433030048696303",
    "0206010433021770368103", "0206010579050104071f7b03",
    "020601057b05010403677803", "020601030e2800422103",
    "02060106790200000000fe0503", "02060106790300000000c3c503",
    "020601067b01000003fffb5703", "02060106732e000000006f6903",
    "0206010473357530ba1f03", "0206010a190100000000000187cf7b9303",
    "02060106152d000004d021f303", "020601043304072e5ab803",
    "020601041c01012a400e03", "020601041c020025f19a03",
    "02060104240100d38cbc03", "0206010424020022bd3803",
    "020601042c010004ce8203", "020601042c0200003f4103",
    "021501023001783f03", "021501023002383e03",
    "0206010433010100c90503", "0206010433030048696303",
    "020601043302176f774903"
]

def generateCRC(iArr):
    """
    iArr : list of integers
    returns list of ints
    """
    # print(f"CRC input: {iArr}")
    iArr2 = [0] * 2
    i, i2 = 1, 0
    while i < len(iArr):
        i3 = i2 ^ iArr[i]
        for i4 in range(8):
            i5 = i3 & 1
            i3 //= 2
            if i5 == 1:
                i3 = i3 ^ 40961
        i += 1
        i2 = i3
    iArr2[0] = i2 & 255
    iArr2[1] = i2 >> 8
    # print(f"CRC input: {iArr2}")
    return iArr2


def generateByteMessage(message):
    """
    message : str
    Returns bytearray
    """
    iArr = [2, 5, 1]
    i = 0
    if message in messageLibrary:
        iArr2 = messageLibrary[message]
    else:
        return bytearray(1)
    iArr3 = [0] * (len(iArr) + 1 + len(iArr2) + 3)
    length = len(iArr)
    i2, i3 = 0, 0
    while i2 < length:
        iArr3[i3] = iArr[i2]
        i2 += 1
        i3 += 1
    iArr3[i3] = len(iArr2)
    length2 = len(iArr2)
    i4 = i3 + 1
    i5 = 0
    while i5 < length2:
        iArr3[i4] = iArr2[i5]
        i5 += 1
        i4 += 1
    crc = generateCRC(iArr3[0:-3])
    length3 = len(crc)
    i6 = 0
    while i6 < length3:
        iArr3[i4] = crc[i6]
        i6 += 1
        i4 += 1
    iArr3[i4] = 3
    bArr = bytearray(len(iArr3))
    length4 = len(iArr3)
    i7 = 0
    while i < length4:
        bArr[i7] = iArr3[i]
        i += 1
        i7 += 1
    return bArr


def getMessageContent_bytes(bArr):
    """returns int"""
    i = 1
    if bArr[1] == 21:
        return -1

    b = bArr[3]
    i2 = 0
    i3 = (b + 5) - 2
    while i3 > 5:
        i2 += bArr[i3] * i
        i *= 256
        i3 -= 1

    if b != 4 or i2 <= 32767:
        return i2
    else:
        return i2 - 65536


def getMessageContent_hexstr(s):
    """returns int"""
    if " " in s:
        s_arr = s.split(" ")
    else:
        n = 2
        s_arr = [s[i:i + n] for i in range(0, len(s), n)]
    i = 1
    if int(s_arr[1], 16) == 21:
        return -1
    parseInt = int(s_arr[3], 16)
    i2 = 0
    i3 = (parseInt + 5) - 2
    while i3 > 5:
        i2 += int(s_arr[i3], 16) * i
        i *= 256
        i3 -= 1
    if parseInt != 4 or i2 <= 32767:
        return i2
    else:
        return i2 - 65536


def byte_array_to_int(value):
    # Raw data is hexstring of int values, as a series of bytes, in little endian byte order
    # values are converted from bytes -> bytearray -> int
    # e.g., b'\xb8\x08\x00\x00' -> bytearray(b'\xb8\x08\x00\x00') -> 2232

    # print(f"{sys._getframe().f_code.co_name}: {value}")

    value = bytearray(value)
    value = int.from_bytes(value, byteorder="little")
    return value


def byte_array_to_char(value):
    # e.g., b'2660,2058,1787,4097\x00' -> 2659,2058,1785,4097
    value = value.decode("utf-8")
    return value
